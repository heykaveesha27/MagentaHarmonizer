<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Music Generator</title>
    <link rel="stylesheet" href="style.css">
   
    <script src="https://kit.fontawesome.com/96a0b3cb5f.js" crossorigin="anonymous"></script>
    <script src="theme.js" defer></script>
    <script src="index.js" defer></script>
    <script src="drum.js" defer></script>

<script src="https://cdn.jsdelivr.net/npm/lodash@4.17.21/lodash.min.js"></script>
<script src="https://cdn.jsdelivr.net/npm/tone@14.7.77/build/Tone.min.js"></script>
<script src="https://cdnjs.cloudflare.com/ajax/libs/startaudiocontext/1.0.1/startaudiocontext.min.js"></script>
<script src="https://unpkg.com/audiokeys@1.2.1/dist/audiokeys.min.js"></script>
<script src="https://cdn.jsdelivr.net/npm/webmidi@2.5.0/dist/webmidi.min.js"></script>
<script src="https://unpkg.com/@tonaljs/tonal@3.8.0/dist/tonal.min.js"></script>
<script src="https://cdn.jsdelivr.net/npm/@tensorflow/tfjs@3.21.0/dist/tf.min.js"></script>
<script src="https://cdn.jsdelivr.net/npm/@magenta/music@1.0.0"></script>
<script src="https://cdn.jsdelivr.net/npm/@tensorflow-models/posenet@2.2.2"></script>
<script src="posenet-control.js" defer></script>
</head>
<body>
   

    <nav>
        <div class="logo">Music Generator</div>
        <div class="midi-status">
    <i class="fa-solid fa-plug" style="margin-right: 5px;"></i>
    <span id="midi-device-name" style="color: #888;">No MIDI device connected</span>
  </div>
        <ul class="nav-links">
           

            <li><a href="https://github.com/heykaveesha27/MagentaHarmonizer.git"><i class="fa-brands fa-github" style="font-size: 20px;"></i></a></li>
            <li>
              <div class="box" style="width: 24px; height: 24px; display: flex; justify-content: center; align-items: center;"><a href="" id="theme-toggle" style="font-size: 20px;"><i class="fa-solid fa-sun"></i></a></li>
        </div>
      </ul>
        
    </nav>
<div class="container" >
    <div class="machine-bg">
    <div class="player"></div>
    <div class="controls">
        <div class="volume">

        <div class="selectGenre" style="display: flex;gap: 0;">
          <button class="genre-btn active" data-value="none"  style="border-bottom-left-radius: 8px;border-top-left-radius: 8px;">Auto</button>
          <button class="genre-btn" data-value="pop">Pop</button>
          <button class="genre-btn" data-value="classical">Classical</button>
          <button class="genre-btn" data-value="jazz">Jazz</button>
          <button class="genre-btn" data-value="edm">EDM</button>
          <button class="genre-btn" data-value="lofi">Lo-Fi</button>
          <button class="genre-btn" data-value="ambient" style="border-bottom-right-radius: 8px;border-top-right-radius: 8px;">Ambient</button>
          <button class="genre-btn" data-value="arpeggio" style="border-bottom-right-radius: 8px;border-top-right-radius: 8px;">Arpeggio</button>
        </div>
        
        <!-- Add after the genre buttons section -->


          
          <div class="drum-btn highlight">
            
            <i class="fa-solid fa-drum"></i>
         
          </div>
        <div style="display: flex; flex-direction: column; align-items: center;">
        <input id="temperature" class="form-range" type="range" min="0.2" max="2" step="0.1" value="1.1" aria-label="Select temperature">
          <label for="temperature">Temperature</label>
        </div>
        <div style="display: flex; flex-direction: column; align-items: center;">
            <input id="tempo" type="range" min="40" max="160" step="1" value="120" aria-label="Tempo">
            <div id="selecting" class="selecting">
              <div class="selectBtn"></div>
              <div id="SelectValue"></div>
            </div>
            <label for="tempo">Tempo (BPM)</label>
          
        </div>
        
        <div style="display: flex; flex-direction: column; align-items: center;">
            <input id="synthvol" type="range" min="0" max="1" step="0.01" value="0.6" aria-label="Tempo">
          <label for="synth">Pad Volume</label>
          
        </div>
        <div style="display: flex; flex-direction: column; align-items: center;">
            <input id="melody" type="range" min="0" max="1" step="0.01" value="0.6" aria-label="Tempo">
          <label for="melody">Melody Volume</label>
          
        </div>
    <!--    <div style="display: flex; flex-direction: column; align-items: center;">
            <input id="drums" type="range" min="0" max="1" step="0.01" value="1" aria-label="Tempo">
            <label for="drums">Drums Volume</label>
          
        </div>-->
        </div>
        <!--
           <div class="select">
        
          <div style="margin-top:8px;">
          <label for="genre">Genre</label>
          <select id="genre" aria-label="Select genre">
           
            <option style="border-top-left-radius: 8px;" value="none">Auto</option>
            <option value="pop">Pop</option>
            <option value="classical">Classical</option>
            <option value="jazz">Jazz</option>
            <option value="edm">EDM</option>
            <option value="lofi">Lo-fi</option>
            <option value="ambient">Ambient</option>
           
          </select>
        </div>


          <button id="generate-drums">Generate Drums</button>
            <button id="drum-startstop" aria-pressed="false">Start</button>
    </div>


  -->






    </div>

 

</div>
      <div class="human-bg">
    <div class="player"></div>
    <div class="controls">
      
  </div>
  
  <div class="keyboard">
  </div>
  <div class="loading">
    Loading...
  </div>

 
      </div>



<div class="drumUI">

     <div style="display: flex; gap: 10px; justify-content: space-around;align-items: center; margin-top: 100px;">
      <button id="generate-drums" class="genre-btn" disabled style="padding: 10px 20px;">
        Loading AI...
      </button><!--
      <div style="display: flex; flex-direction: column; align-items: center;">
        <input id="drum-temperature" type="range" min="0.5" max="2" step="0.1" value="1.0" style="width: 150px;">
        <label for="drum-temperature" style="font-size: 12px;">Creativity</label>
      </div>-->
      <button id="clear-drums" class="genre-btn" style="padding: 10px 20px;">
        Clear Grid
      </button>
    </div>

     <div class="sequencer">
        <div class="instruments" style="margin-top: 30px;">
        <div style="height: 40px; width: 120px;text-align: center;display: flex; gap: 10px;margin-right: 40px;"><input type="range" value="70" min="0" max="100" class="newSlider" id="kickGain"></div>
          <div style="height: 40px; width: 120px;text-align: center;display: flex; gap: 10px;margin-right: 40px;"><input type="range" value="70" min="0" max="100" class="newSlider" id="snareGain"></div>
          <div  style="height: 40px; width: 120px;text-align: center;display: flex; gap: 10px;margin-right: 10px;"><input type="range" value="70" min="0" max="100" class="newSlider" id="hatGain"></div>
          <div  style="height: 40px; width: 120px;text-align: center;display: flex; gap: 10px;margin-right: 40px;"><input type="range" value="70" min="0" max="100" class="newSlider" id="clapGain"></div>
          <div  style="height: 40px; width: 120px;text-align: center;display: flex; gap: 10px;margin-right: 40px;"><input type="range" value="70" min="0" max="100" class="newSlider" id="congaGain"></div>
          <div style="height: 40px; width: 120px;text-align: center;display: flex; gap: 10px;margin-right: 40px;"><input type="range" value="70" min="0" max="100" class="newSlider" id="tomGain"></div>
          <div  style="height: 40px; width: 120px;text-align: center;display: flex; gap: 10px;margin-right: 40px;"><input type="range" value="70" min="0" max="100" class="newSlider" id="tambGain"></div>
          <div  style="height: 40px; width: 120px;text-align: center;display: flex; gap: 10px;margin-right: 40px;"><input type="range" value="70" min="0" max="100" class="newSlider" id="openhatGain"></div>
        </div>

        <div class="names" style="margin-top: 0px;display: flex; flex-direction: column; justify-content: space-evenly;height: 340px;width: 100px;margin-right: 20px;" >
          <label for="" style="white-space: nowrap;overflow: hidden; text-align: center;">Kick</label>
          <label for="" style="white-space: nowrap;overflow: hidden; text-align: center;">Snare</label>
          <label for="" style="white-space: nowrap;overflow: hidden; text-align: center;">Closed Hat</label>
          <label for="" style="white-space: nowrap;overflow: hidden; text-align: center;">Clap</label>
          <label for="" style="white-space: nowrap;overflow: hidden; text-align: center;">Conga</label>
          <label for="" style="white-space: nowrap;overflow: hidden; text-align: center;">Tom</label>
          <label for="" style="white-space: nowrap;overflow: hidden; text-align: center;">Tamb</label>
          <label for="" style="white-space: nowrap;overflow: hidden;">Open Hat</label>
        </div>
        <canvas id="mycanvas" width="960" height="320" style="width:100%;max-width:960px;border:1px solid rgba(255,255,255,0.08);background:#0b0b0b;"></canvas>
        <div style="display: flex; align-items: center; margin-left: 15px;">
              <label for="" style="writing-mode: sideways-lr;">Drums Gain</label>
              <input id="drums-all" type="range" min="0" max="1" step="0.01" value="0.7" aria-label="Tempo">
          
        </div>
        

                    <!-- Add this drum generation controls section -->
   
   
<!--
         <div style="display: flex; align-items: center; margin-left: 10px;">
              <label for="" style="writing-mode: sideways-lr;">Master</label>
              <input id="drums-all" type="range" min="0" max="1" step="0.01" value="1" aria-label="Tempo">
          
        </div>
        -->
      </div>


   

</div>      

</div>      
<!-- PoseNet Webcam Section -->
<!-- PoseNet Webcam Section - Replace the existing section in your HTML -->
<div class="posenet-section" style="margin-top: 50px; text-align: center;">
    <h2 style="color: #38bdf8; margin-bottom: 10px;">Body Control with AI</h2>
    <p style="color: #888; margin-bottom: 20px; font-size: 14px;">
        Control drums and volume with hand gestures using PoseNet AI
    </p>
    
    <div class="video-container" style="position: relative; display: inline-block; margin-bottom: 20px;">
        <video id="webcam" width="640" height="480" autoplay style="border-radius: 8px; background: #000;"></video>
        <canvas id="output" width="640" height="480" style="position: absolute; top: 0; left: 0;"></canvas>
    </div>
    
    <div style="margin-top: 20px; display: flex; gap: 15px; justify-content: center; align-items: center; flex-wrap: wrap;">
        <button id="startPoseNet" class="genre-btn" style="padding: 8px 20px; background: #3369af; color: white;">
            ğŸ¥ Start Body Control
        </button>
        <button id="stopPoseNet" class="genre-btn" style="padding: 8px 20px; background: #ef4444; color: white; display: none;">
            ğŸ›‘ Stop Camera
        </button>
        
        <div style="display: flex; flex-direction: column; gap: 5px;">
            <label style="font-size: 14px; color: #888;">Control Mode:</label>
            <select id="poseControlMode" class="genre-btn" style="padding: 8px 16px;">
                <option value="volume">ğŸ”Š Volume Control</option>
                <option value="drum-generate">ğŸµ Generate Drums</option>
                <option value="drum-trigger">ğŸ¥ Trigger Drums</option>
            </select>
        </div>
    </div>
    
    <div id="poseStatus" style="margin-top: 20px; font-size: 14px; color: #888; padding: 10px; background: rgba(255,255,255,0.03); border-radius: 6px; display: inline-block;">
        Camera not started
    </div>
    
    <!-- Gesture Instructions -->
    <div style="margin-top: 30px; text-align: left; max-width: 700px; margin-left: auto; margin-right: auto; background: rgba(255,255,255,0.03); padding: 20px; border-radius: 8px;">
        <h3 style="color: #39bdf8; margin-bottom: 15px;">ğŸ“‹ Gesture Instructions</h3>
        
        <div style="margin-bottom: 15px;">
            <h4 style="color: #fff; font-size: 16px; margin-bottom: 8px;">ğŸ”Š Volume Control Mode:</h4>
            <ul style="color: #a0a0a0; font-size: 14px; line-height: 1.8; list-style-position: inside;">
                <li><strong style="color: #4CAF50;">Spread hands wide</strong> â†’ Increase master volume</li>
                <li><strong style="color: #3b82f6;">Bring hands close</strong> â†’ Decrease master volume</li>
                <li><strong style="color: #f59e0b;">Left hand height</strong> â†’ Control synth volume</li>
                <li><strong style="color: #ef4444;">Right hand height</strong> â†’ Control melody volume</li>
            </ul>
        </div>
        
        <div style="margin-bottom: 15px;">
            <h4 style="color: #fff; font-size: 16px; margin-bottom: 8px;">ğŸµ Generate Drums Mode:</h4>
            <ul style="color: #a0a0a0; font-size: 14px; line-height: 1.8; list-style-position: inside;">
                <li><strong style="color: #39bdf8;">Raise BOTH hands</strong> above shoulders</li>
                <li><strong style="color: #10b981;">Hold for 1 second</strong> â†’ AI generates drum pattern!</li>
                <li>2 second cool down between generations</li>
            </ul>
        </div>
        
        <div>
            <h4 style="color: #fff; font-size: 16px; margin-bottom: 8px;">ğŸ¥ Trigger Drums Mode:</h4>
            <ul style="color: #a0a0a0; font-size: 14px; line-height: 1.8; list-style-position: inside;">
                <li><strong style="color: #ef4444;">Left hand up</strong> â†’ Kick drum</li>
                <li><strong style="color: #3b82f6;">Right hand up</strong> â†’ Snare drum</li>
                <li><strong style="color: #10b981;">Both hands up</strong> â†’ Hi-hat</li>
                <li><strong style="color: #f59e0b;">Hands together (clap)</strong> â†’ Clap sound</li>
            </ul>
        </div>
    </div>
    
    <!-- Performance Tips -->
    <div style="margin-top: 20px; padding: 15px; background: rgba(245, 158, 11, 0.1); border-left: 4px solid #f59e0b; border-radius: 4px; text-align: left; max-width: 700px; margin-left: auto; margin-right: auto;">
        <h4 style="color: #f59e0b; font-size: 14px; margin-bottom: 8px;">ğŸ’¡ Tips for Best Results:</h4>
        <ul style="color: #d0d0d0; font-size: 13px; line-height: 1.6; list-style-position: inside;">
            <li>Ensure good lighting for better pose detection</li>
            <li>Stand 3-5 feet away from camera</li>
            <li>Keep upper body visible (shoulders and hands)</li>
            <li>Move smoothly - sudden movements may not register</li>
            <li>Wear contrasting colors to background</li>
        </ul>
    </div>
</div>
  
</div>

<!-- Add after the drum button -->
<div id="melody-sync-status" style="
  display: none;
  padding: 8px 12px;
  background: rgba(30, 136, 229, 0.1);
  border: 1px solid rgba(30, 136, 229, 0.3);
  border-radius: 8px;
  font-size: 13px;
  color: #1E88E5;
  text-align: center;">
  <i class="fa-solid fa-clock"></i>
  <span id="sync-countdown">Syncing...</span>
</div>

<!-- Add in controls section -->
<div id="beat-indicator" style="
  display: flex;
  gap: 8px;
  padding: 10px;
  justify-content: center;">
  <div class="beat-dot" data-beat="1"></div>
  <div class="beat-dot" data-beat="2"></div>
  <div class="beat-dot" data-beat="3"></div>
  <div class="beat-dot" data-beat="4"></div>
</div>

<style>
.beat-dot {
  width: 12px;
  height: 12px;
  border-radius: 50%;
  background: rgba(255,255,255,0.2);
  transition: all 0.1s;
}

.beat-dot.active {
  background: #1E88E5;
  box-shadow: 0 0 10px #1E88E5;
  transform: scale(1.3);
}

.beat-dot.downbeat {
  background: #E91E63;
  box-shadow: 0 0 10px #E91E63;
}
</style>
</body>
</html>